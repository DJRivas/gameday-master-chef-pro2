const STORAGE_KEY='kickoff-ratings';const ENTRANTS=['Javier','Lindsay','Yesenia','Bryan','Viviana','Bernie','Rogelio','Daniella','Colleen','Justin','Paige','Nic','Martha'];
const tasteEmojis={1:'🤢',2:'😖',3:'🙂',4:'😋',5:'🤤🔥'};const presEmojis={1:'🙈',2:'😬',3:'🙂',4:'😍',5:'🤩✨'};const easyEmojis={1:'🥴',2:'😕',3:'🙂',4:'👍',5:'🏈👌'};
function loadData(){try{const raw=localStorage.getItem(STORAGE_KEY);return raw?JSON.parse(raw):[]}catch{return[]}}
function saveData(arr){localStorage.setItem(STORAGE_KEY,JSON.stringify(arr))}
const entrantSelect=document.getElementById('entrant');ENTRANTS.forEach((name,i)=>{const opt=document.createElement('option');opt.value=i;opt.textContent=name;entrantSelect.appendChild(opt)});
const taste=document.getElementById('taste'),presentation=document.getElementById('presentation'),easy=document.getElementById('easy');
const tasteEmoji=document.getElementById('tasteEmoji'),presEmoji=document.getElementById('presEmoji'),easyEmoji=document.getElementById('easyEmoji');
const tasteScore=document.getElementById('tasteScore'),presScore=document.getElementById('presScore'),easyScore=document.getElementById('easyScore');
function syncEmoji(){const tv=+taste.value,pv=+presentation.value,ev=+easy.value;tasteEmoji.textContent=tasteEmojis[tv];presEmoji.textContent=presEmojis[pv];easyEmoji.textContent=easyEmojis[ev];tasteScore.textContent=`${tv} / 5`;presScore.textContent=`${pv} / 5`;easyScore.textContent=`${ev} / 5`}
;['input','change'].forEach(e=>{taste.addEventListener(e,syncEmoji);presentation.addEventListener(e,syncEmoji);easy.addEventListener(e,syncEmoji)});syncEmoji();
const form=document.getElementById('rateForm'),thanks=document.getElementById('thanks');
function resetForm(){form.reset();entrantSelect.selectedIndex=0;taste.value=3;presentation.value=3;easy.value=3;syncEmoji()}
form.addEventListener('submit',e=>{e.preventDefault();const entrantIndex=+entrantSelect.value;if(isNaN(entrantIndex)){alert('Please select a participant.');return;}
const data=loadData();const existing=data.find(r=>r.entrantIndex===entrantIndex);if(existing){existing.taste=+taste.value;existing.presentation=+presentation.value;existing.easy=+easy.value;existing.judge=(document.getElementById('judge').value||'').trim();existing.ts=Date.now()}else{const rec={entrantIndex,taste:+taste.value,presentation:+presentation.value,easy:+easy.value,judge:(document.getElementById('judge').value||'').trim(),ts:Date.now()};data.push(rec)}saveData(data);form.classList.add('hidden');thanks.classList.remove('hidden');renderResults()});
document.getElementById('rateAnother').addEventListener('click',()=>{thanks.classList.add('hidden');form.classList.remove('hidden');resetForm()});
function renderResults(){const data=loadData();const agg=new Map();ENTRANTS.forEach((_,i)=>agg.set(i,{votes:0,t:0,p:0,e:0,records:[]}));for(const r of data){const a=agg.get(r.entrantIndex);a.votes++;a.t+=r.taste;a.p+=r.presentation;a.e+=r.easy;a.records.push(r)}const rows=[];ENTRANTS.forEach((name,i)=>{const a=agg.get(i);if(!a.votes)return rows.push({name,votes:0,at:0,ap:0,ae:0,total:0,records:[]});const at=+(a.t/a.votes).toFixed(2),ap=+(a.p/a.votes).toFixed(2),ae=+(a.e/a.votes).toFixed(2);const total=+((a.t+a.p+a.e)/a.votes).toFixed(2);rows.push({name,votes:a.votes,at,ap,ae,total,records:a.records})});rows.sort((a,b)=>b.total-a.total);const trophy=i=>i===0?'🏆':'';const tbody=document.querySelector('#resultsTable tbody');tbody.innerHTML=rows.map((r,i)=>`<tr><td class="medal">${trophy(i)}</td><td>${r.name}</td><td>${r.votes}</td><td>${r.at.toFixed(2)}</td><td>${r.ap.toFixed(2)}</td><td>${r.ae.toFixed(2)}</td><td><strong>${r.total.toFixed(2)}</strong></td></tr>`).join('');window._rowsForDetails=rows}
renderResults();
const detailsCard=document.getElementById('detailsCard');function promptPassword(){const pw=prompt('Enter password to view full results:');if(pw==='MASTERCHEF2025'){detailsCard.classList.remove('hidden');renderDetails()}else if(pw){alert('Incorrect password')}}document.addEventListener('keydown',e=>{if(e.altKey&&e.key==='D'){promptPassword()}});
function renderDetails(){const rows=window._rowsForDetails||[];const container=document.getElementById('detailsContent');container.innerHTML=rows.map(r=>`<h3>${r.name}</h3><ul>`+r.records.map(rec=>`<li>${rec.judge||'Anon'} – Taste:${rec.taste}, Pres:${rec.presentation}, Easy:${rec.easy}</li>`).join('')+'</ul>').join('')}
